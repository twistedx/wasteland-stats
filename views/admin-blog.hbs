<section id="admin-section">
  {{> admin-nav}}

  {{#if successMessage}}
    <div class="success-notice">{{successMessage}}</div>
  {{/if}}
  {{#if errorMessage}}
    <div class="error">{{errorMessage}}</div>
  {{/if}}

  <div class="admin-bar">
    <a href="/admin/blog/new" class="btn btn-admin">New Post</a>
  </div>

  {{#if posts.length}}
    <!-- Desktop table -->
    <div class="table-scroll blog-table-desktop">
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Tags</th>
            <th>Status</th>
            <th>Author</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#each posts}}
            <tr>
              <td><a href="/blog/{{this.slug}}" class="blog-table-link">{{this.title}}</a></td>
              <td>{{#each this.tags}}<span class="blog-tag-pill">{{this}}</span> {{/each}}</td>
              <td>
                {{#if this.published}}
                  <span class="blog-status-published">Published</span>
                {{else}}
                  <span class="blog-status-draft">Draft</span>
                {{/if}}
              </td>
              <td class="player-name">{{this.author}}</td>
              <td>{{formatDate this.createdAt}}</td>
              <td class="blog-actions">
                <a href="/admin/blog/edit/{{this.id}}" class="btn btn-small">Edit</a>
                <form method="POST" action="/admin/blog/delete/{{this.id}}" style="display:inline;" onsubmit="return confirm('Delete this post?');">
                  <button type="submit" class="btn btn-small btn-danger">Delete</button>
                </form>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- Mobile accordion -->
    <div class="blog-accordion-mobile">
      {{#each posts}}
        <div class="blog-post-card">
          <div class="blog-post-card-header" onclick="this.parentElement.classList.toggle('open')">
            <span class="blog-post-card-title">{{this.title}}</span>
            <div class="blog-post-card-right">
              {{#if this.published}}
                <span class="blog-status-published">Published</span>
              {{else}}
                <span class="blog-status-draft">Draft</span>
              {{/if}}
              <svg class="blog-post-card-chevron" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>
            </div>
          </div>
          <div class="blog-post-card-body">
            <div class="blog-post-card-row">
              <span class="blog-post-card-label">Author</span>
              <span>{{this.author}}</span>
            </div>
            <div class="blog-post-card-row">
              <span class="blog-post-card-label">Date</span>
              <span>{{formatDate this.createdAt}}</span>
            </div>
            <div class="blog-post-card-row">
              <span class="blog-post-card-label">Tags</span>
              <span>{{#each this.tags}}<span class="blog-tag-pill">{{this}}</span> {{/each}}{{#unless this.tags.length}}-{{/unless}}</span>
            </div>
            <div class="blog-post-card-row" style="padding-top:0.6rem;gap:0.5rem;">
              <a href="/blog/{{this.slug}}" class="btn btn-admin btn-small" style="flex:1;text-align:center;">View</a>
              <a href="/admin/blog/edit/{{this.id}}" class="btn btn-small" style="flex:1;text-align:center;">Edit</a>
              <form method="POST" action="/admin/blog/delete/{{this.id}}" style="flex:1;" onsubmit="return confirm('Delete this post?');">
                <button type="submit" class="btn btn-small btn-danger" style="width:100%;">Delete</button>
              </form>
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  {{else}}
    <div class="empty-state">No blog posts yet. Create your first post!</div>
  {{/if}}
</section>

{{> ban-modal}}
