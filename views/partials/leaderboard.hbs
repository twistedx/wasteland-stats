<section id="leaderboard-section">
  <h2>Leaderboard</h2>
  <div class="tab-bar lb-tab-bar">
    <button class="lb-hamburger" id="lb-hamburger" aria-label="Toggle menu">
      <span></span><span></span><span></span>
    </button>
    <div class="lb-tabs" id="lb-tabs">
      <a href="/?tab=season" class="tab {{#if (eq tab 'season')}}active{{/if}}">Current Season</a>
      <a href="/?tab=alltime" class="tab {{#if (eq tab 'alltime')}}active{{/if}}">All Time</a>
      <span class="tab-spacer"></span>
      <button class="tab active" id="btn-detail-view">Detail View</button>
      <button class="tab" id="btn-graph-view">Graph View</button>
    </div>
  </div>

  <div id="leaderboard-detail">
    {{#if leaderboardError}}
      <div class="error">Failed to load leaderboard. Please try again.</div>
    {{else if leaderboard.length}}
      <!-- Desktop table -->
      <div class="lb-table-desktop">
        <table id="leaderboard-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>Kills</th>
              <th>Deaths</th>
              <th>K/D</th>
              <th>Most Killed</th>
              <th>Nemesis</th>
            </tr>
          </thead>
          <tbody>
            {{#each leaderboard}}
              <tr {{#if (eq @index 0)}}class="rank-1"{{else if (eq @index 1)}}class="rank-2"{{else if (eq @index 2)}}class="rank-3"{{/if}}>
                <td class="rank">{{math @index 1}}</td>
                <td class="player-name">{{fallback this.arma_username "Unknown"}}</td>
                <td>{{formatNumber this.kill_count}}</td>
                <td>{{formatNumber this.deaths}}</td>
                <td>{{fallback this.kdRatio "0.0"}}</td>
                <td>{{fallback this.mostKilled "-"}} ({{fallback this.mostKilledCount "0"}})</td>
                <td>{{fallback this.mostKilledBy "-"}} ({{fallback this.mostKilledByCount "0"}})</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <!-- Mobile accordion -->
      <div class="lb-accordion-mobile">
        {{#each leaderboard}}
          <div class="lb-card {{#if (eq @index 0)}}lb-rank-1{{else if (eq @index 1)}}lb-rank-2{{else if (eq @index 2)}}lb-rank-3{{/if}}">
            <div class="lb-card-header" onclick="this.parentElement.classList.toggle('open')">
              <span class="lb-card-rank">{{math @index 1}}</span>
              <span class="lb-card-name">{{fallback this.arma_username "Unknown"}}</span>
              <div class="lb-card-right">
                <span class="lb-card-kd">{{fallback this.kdRatio "0.0"}} K/D</span>
                <svg class="lb-card-chevron" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>
              </div>
            </div>
            <div class="lb-card-body">
              <div class="lb-card-row">
                <span class="lb-card-label">Kills</span>
                <span>{{formatNumber this.kill_count}}</span>
              </div>
              <div class="lb-card-row">
                <span class="lb-card-label">Deaths</span>
                <span>{{formatNumber this.deaths}}</span>
              </div>
              <div class="lb-card-row">
                <span class="lb-card-label">K/D Ratio</span>
                <span>{{fallback this.kdRatio "0.0"}}</span>
              </div>
              <div class="lb-card-row">
                <span class="lb-card-label">Most Killed</span>
                <span>{{fallback this.mostKilled "-"}} ({{fallback this.mostKilledCount "0"}})</span>
              </div>
              <div class="lb-card-row">
                <span class="lb-card-label">Nemesis</span>
                <span>{{fallback this.mostKilledBy "-"}} ({{fallback this.mostKilledByCount "0"}})</span>
              </div>
            </div>
          </div>
        {{/each}}
      </div>
    {{else}}
      <div class="lb-table-desktop">
        <table id="leaderboard-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>Kills</th>
              <th>Deaths</th>
              <th>K/D</th>
              <th>Most Killed</th>
              <th>Nemesis</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="7" class="empty">No data available</td></tr>
          </tbody>
        </table>
      </div>
      <div class="lb-accordion-mobile">
        <div class="empty-state">No data available</div>
      </div>
    {{/if}}
  </div>

  <div id="leaderboard-graphs" class="leaderboard-graphs" style="display:none;">
    <div class="dash-grid">
      <div class="dash-panel dash-panel-wide">
        <div class="dash-panel-header">Kill Leaderboard — Current Season</div>
        <div id="home-chart-kills" class="dash-chart"></div>
      </div>
      <div class="dash-panel">
        <div class="dash-panel-header">K/D Ratio — Top Players</div>
        <div id="home-chart-kd" class="dash-chart"></div>
      </div>
      <div class="dash-panel">
        <div class="dash-panel-header">Shots Fired Breakdown</div>
        <div id="home-chart-shots" class="dash-chart"></div>
      </div>
    </div>
  </div>

  <div class="cta-grid{{#if user}} cta-grid-single{{/if}}">
    {{#unless user}}
      <div class="cta-card">
        <h3>Track Your Stats</h3>
        <p>Login to see your personal kills, deaths, K/D ratio, and more.</p>
        <a href="/auth/discord" class="btn btn-discord">Login with Discord</a>
      </div>
    {{/unless}}
    <div class="cta-card">
      <h3>Support the Server</h3>
      <p>Help keep the fight going and the servers running strong.</p>
      <a href="https://www.iwannaplaygames.com/products" target="_blank" rel="noopener" class="btn btn-donate">Donate Today</a>
    </div>
  </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var btn = document.getElementById('lb-hamburger');
  var tabs = document.getElementById('lb-tabs');
  if (!btn || !tabs) return;
  btn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    btn.classList.toggle('open');
    tabs.classList.toggle('open');
  });
  tabs.querySelectorAll('.tab').forEach(function(tab) {
    tab.addEventListener('click', function() {
      btn.classList.remove('open');
      tabs.classList.remove('open');
    });
  });
  document.addEventListener('click', function(e) {
    if (!btn.contains(e.target) && !tabs.contains(e.target)) {
      btn.classList.remove('open');
      tabs.classList.remove('open');
    }
  });
});
</script>
