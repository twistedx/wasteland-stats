<section id="admin-section">
  {{> admin-nav}}

  {{#if successMessage}}
    <div class="notice success-notice">
      <strong>Success</strong>
      <p>{{successMessage}}</p>
    </div>
  {{/if}}

  {{#if errorMessage}}
    <div class="error">{{errorMessage}}</div>
  {{/if}}

  <form class="filter-bar" method="GET" action="/admin/bans">
    <input
      type="text"
      name="search"
      class="filter-input"
      placeholder="Search bans..."
      value="{{search}}"
    >
    <select name="field" class="filter-select">
      <option value="all" {{#if (eq field 'all')}}selected{{/if}}>All Fields</option>
      <option value="username" {{#if (eq field 'username')}}selected{{/if}}>Username</option>
      <option value="guid" {{#if (eq field 'guid')}}selected{{/if}}>Arma GUID</option>
      <option value="banned_by" {{#if (eq field 'banned_by')}}selected{{/if}}>Banned By</option>
      <option value="reason" {{#if (eq field 'reason')}}selected{{/if}}>Reason</option>
    </select>
    <div class="filter-actions">
      <button type="submit" class="btn btn-admin">Search</button>
      <a href="/admin/bans/export" class="btn btn-admin btn-export">Export CSV</a>
    </div>
  </form>

  {{#if bansError}}
    <div class="error">Failed to load ban list. Please try again.</div>
  {{else}}
    <p class="result-count">{{banCount}} ban{{#unless (eq banCount 1)}}s{{/unless}} found</p>

    {{#if bans.length}}
      <!-- Desktop table -->
      <div class="table-scroll bans-table-desktop">
        <table id="ban-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Discord</th>
              <th>Arma GUID</th>
              <th>Ban Date</th>
              <th>Banned By</th>
              <th>Reason</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody>
            {{#each bans}}
              <tr>
                <td class="player-name">{{fallback this.banned_arma_username "Unknown"}}</td>
                <td>{{fallback this.banned_discord_username "-"}}</td>
                <td class="guid">{{fallback this.user_id_banned "-"}}</td>
                <td>{{formatDate this.time_stamp}}</td>
                <td>{{fallback this.admin_name "-"}}</td>
                <td class="reason-cell">{{fallback this.reason "-"}}</td>
                <td>{{#if (eq this.duration_hours -1)}}Permanent{{else}}{{this.duration_hours}}h{{/if}}</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <!-- Mobile accordion cards -->
      <div class="bans-accordion-mobile">
        {{#each bans}}
          <div class="ban-card">
            <div class="ban-card-header" onclick="this.parentElement.classList.toggle('open')">
              <span class="ban-card-name">{{fallback this.banned_arma_username "Unknown"}}</span>
              <div class="ban-card-right">
                <span class="ban-card-duration {{#if (eq this.duration_hours -1)}}ban-permanent{{/if}}">{{#if (eq this.duration_hours -1)}}Permanent{{else}}{{this.duration_hours}}h{{/if}}</span>
                <svg class="ban-card-chevron" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>
              </div>
            </div>
            <div class="ban-card-body">
              <div class="ban-card-row">
                <span class="ban-card-label">Discord</span>
                <span>{{fallback this.banned_discord_username "-"}}</span>
              </div>
              <div class="ban-card-row">
                <span class="ban-card-label">GUID</span>
                <span class="guid">{{fallback this.user_id_banned "-"}}</span>
              </div>
              <div class="ban-card-row">
                <span class="ban-card-label">Date</span>
                <span>{{formatDate this.time_stamp}}</span>
              </div>
              <div class="ban-card-row">
                <span class="ban-card-label">Banned By</span>
                <span>{{fallback this.admin_name "-"}}</span>
              </div>
              <div class="ban-card-row">
                <span class="ban-card-label">Reason</span>
                <span class="ban-card-reason">{{fallback this.reason "-"}}</span>
              </div>
            </div>
          </div>
        {{/each}}
      </div>
    {{else}}
      <div class="empty-state">No bans match your search.</div>
    {{/if}}
  {{/if}}

</section>

{{> ban-modal}}
